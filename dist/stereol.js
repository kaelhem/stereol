var t=function(t){var r=t[0],n=t[1],e=t[2],i=r[0],o=r[1],u=r[2],a=n[0]-i,l=n[1]-o,f=n[2]-u,s=e[0]-i,c=e[1]-o,d=e[2]-u,p=l*d-f*c,v=f*s-a*d,g=a*c-l*s,y=Math.sqrt(p*p+v*v+g*g);return 0===y?[0,0,0]:[p,v,g].map((function(t){return t/y}))},r=function(t,r,n){return[t,r,n].map((function(t){return t.toExponential()}))},n=function(t,n){return"facet normal "+r.apply(void 0,t).join(" ")+"\n  outer loop\n    vertex "+r.apply(void 0,n[0]).join(" ")+"\n    vertex "+r.apply(void 0,n[1]).join(" ")+"\n    vertex "+r.apply(void 0,n[2]).join(" ")+"\n  endloop\nendfacet\n"},e=function(t){for(var r=t.split("\n").filter((function(t){return""!==t.trim()})),n=r[0],e=r.slice(1),i=[],o=0,u=!1;!u&&o<e.length&&-1===e[o].indexOf("endsolid");)(u=(u=(u=(u=(u=e.length<o+6)||-1===e[o].indexOf("normal "))||-1===e[o+2].indexOf("vertex "))||-1===e[o+3].indexOf("vertex "))||-1===e[o+4].indexOf("vertex "))||(i.push({normal:e[o].split("normal ")[1].trim().split(" ").map((function(t){return parseFloat(t)})),verts:[e[o+2].split("vertex ")[1].trim().split(" ").map((function(t){return parseFloat(t)})),e[o+3].split("vertex ")[1].trim().split(" ").map((function(t){return parseFloat(t)})),e[o+4].split("vertex ")[1].trim().split(" ").map((function(t){return parseFloat(t)}))]}),o+=7);if(u)throw new Error("This file is not formatted correctly.");return{description:n.slice(6),facets:i}},i=function(t,r){return void 0===r&&(r=255),Math.max(0,Math.min(r,parseInt(t,10)))},o=function(t){return i(t,31).toString(2).padStart(5,"0")},u=function(t){return i(t).toString(2).padStart(8,"0")},a=function(t){var r=t[0],n=t[1];return Number("0b"+o(t[2])+o(n)+o(r)+"1")},l=function(t){var r=t[1],n=t[2],e=t[3];return Number("0b"+u(t[0])+u(r)+u(n)+u(e))},f=void 0;try{f=Boolean(Buffer)}catch(t){f=!1}var s=function(t,r,n){switch(void 0===n&&(n=0),r){case"uint8":return f?t.readUInt8(n):t.getUint8(n);case"uint16":return f?t.readUInt16LE(n):t.getUint16(n,!0);case"uint32":return f?t.readUInt32LE(n):t.getUint32(n,!0);case"float":return f?t.readFloatLE(n):t.getFloat32(n,!0);default:throw new Error("No type specified")}},c=function(t){return(new TextDecoder).decode(t)};module.exports={exportStl:function(r,e){void 0===e&&(e={});var i=e.description,o=void 0===i?"":i,u=e.binary,s=e.color,c=void 0===s?null:s,d=e.material,p=void 0===d?null:d;if(void 0===u||u){var v=Array.isArray(c)&&4===c.length?c:null,g=v&&Array.isArray(p)&&3===p.length?p:null;if(g){var y=p[0],m=p[1],h=p[2];g=(g=(g=g&&Array.isArray(y)&&3===y.length?p:null)&&Array.isArray(m)&&3===m.length?p:null)&&Array.isArray(h)&&3===h.length?p:null}return function(r,n,e,i){var o=r.length,u=function(t){var r=f?Buffer.alloc(t):new DataView(new ArrayBuffer(t));return f&&r.fill(0,0,80),{writeBuffer:function(t,n,e){switch(void 0===e&&(e=0),t){case"uint8":return f?r.writeUInt8(n,e):r.setUint8(e,n);case"uint16":return f?r.writeUInt16LE(n,e):r.setUint16(e,n,!0);case"uint32":return f?r.writeUInt32LE(n,e):r.setUint32(e,n,!0);case"float":return f?r.writeFloatLE(n,e):r.setFloat32(e,n,!0);case"string":return f?r.write(n,e):function(t,r,n){void 0===r&&(r=""),void 0===n&&(n=0);var e=0;r.split("").forEach((function(r){t.setUint8(n+e,r.charCodeAt(0)),++e}))}(r,n,e);default:throw new Error("No type specified")}},getBuffer:function(){return f?r:r.buffer}}}(84+12*o*4+2*o),s=u.writeBuffer,c=u.getBuffer;if(s("string",n),e){s("string"," COLOR=",47);var d=e[1],p=e[2],v=e[3];if(s("uint8",e[0],54),s("uint8",d,55),s("uint8",p,56),s("uint8",v,57),i){s("string",",MATERIAL=",58);var g=i[1],y=i[2];s("uint32",l(i[0]),68),s("uint32",l(g),72),s("uint32",l(y),76)}}s("uint32",o,80);for(var m=84,h=function(t){s("float",t,m),m+=4},x=0;x<r.length;x++){var w=r[x],A=w.normal||t(w.verts);h(A[0]),h(A[1]),h(A[2]);for(var E=0;E<w.verts.length;E++){var O=w.verts[E];h(O[0]),h(O[1]),h(O[2])}var U=w.color?a(w.color):0;s("uint16",U,m),m+=2}return c()}(r,o,v,g)}return function(r,e){void 0===e&&(e="");for(var i="solid "+e.split(" COLOR=")[0].trim()+"\n",o=0;o<r.length;o++){var u=r[o],a=u.verts,l=u.normal||t(a);i+=n(l,a)}return i+"endsolid"}(r,o)},importStl:function(t){return"string"==typeof t&&"solid "===t.slice(0,6)?(console.log("type: ascii string"),e(t)):"undefined"!=typeof TextEncoder&&"object"==typeof t&&"solid "===c(t.slice(0,6))?(console.log("type: ascii string in ArrayBuffer (browser only)"),e(c(t))):"undefined"==typeof TextEncoder&&"object"==typeof t&&"solid "===t.toString().slice(0,6)?(console.log("type: ascii string in Buffer (nodeJS only)"),e(t.toString())):(console.log("type: binary buffer"),function(t){for(var r=f?Buffer.from(t):new DataView(t),n=[],e=0;e<80;++e)n.push(s(r,"uint8",e));var i=String.fromCharCode.apply(String,n),o=i.indexOf(" COLOR="),u=null;-1!==o&&(u=[s(r,"uint8",o+7),s(r,"uint8",o+8),s(r,"uint8",o+9),s(r,"uint8",o+10)]);var a=null;-1!==i.indexOf("MATERIAL=")&&(a=[s(r,"uint32",o+9),s(r,"uint32",o+13),s(r,"uint32",o+17)]);for(var l=[],c=s(r,"uint32",80),d=84,p=function(){return s(r,"float",(d+=4)-4)},v=0;v<c;++v){var g=[p(),p(),p()],y=[[p(),p(),p()],[p(),p(),p()],[p(),p(),p()]],m=s(r,"uint16",d);d+=2,l.push({normal:g,verts:y,color:m})}return{description:i,facets:l,color:u,material:a}}(t))}};
//# sourceMappingURL=stereol.js.map
