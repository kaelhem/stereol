var t=function(t){var r=t[0],n=t[1],e=t[2],i=r[0],o=r[1],a=r[2],l=n[0]-i,u=n[1]-o,f=n[2]-a,s=e[0]-i,c=e[1]-o,d=e[2]-a,v=u*d-f*c,p=f*s-l*d,g=l*c-u*s,y=Math.sqrt(v*v+p*p+g*g);return 0===y?[0,0,0]:[v,p,g].map((function(t){return t/y}))},r=function(t,r,n){return[t,r,n].map((function(t){return t.toExponential()}))},n=function(t,n){return"facet normal "+r.apply(void 0,t).join(" ")+"\n  outer loop\n    vertex "+r.apply(void 0,n[0]).join(" ")+"\n    vertex "+r.apply(void 0,n[1]).join(" ")+"\n    vertex "+r.apply(void 0,n[2]).join(" ")+"\n  endloop\nendfacet\n"},e=function(t){for(var r=t.split("\n").filter((function(t){return""!==t.trim()})),n=r[0],e=r.slice(1),i=[],o=0,a=!1;!a&&o<e.length&&-1===e[o].indexOf("endsolid");)(a=(a=(a=(a=(a=e.length<o+6)||-1===e[o].indexOf("normal "))||-1===e[o+2].indexOf("vertex "))||-1===e[o+3].indexOf("vertex "))||-1===e[o+4].indexOf("vertex "))||(i.push({normal:e[o].split("normal ")[1].trim().split(" ").map((function(t){return parseFloat(t)})),verts:[e[o+2].split("vertex ")[1].trim().split(" ").map((function(t){return parseFloat(t)})),e[o+3].split("vertex ")[1].trim().split(" ").map((function(t){return parseFloat(t)})),e[o+4].split("vertex ")[1].trim().split(" ").map((function(t){return parseFloat(t)}))]}),o+=7);if(a)throw new Error("This file is not formatted correctly.");return{description:n.slice(6),facets:i}},i=function(t){return(r=t,void 0===n&&(n=255),Math.max(0,Math.min(n,parseInt(r,10)))).toString(2).padStart(8,"0");var r,n},o=function(t){var r=t[1],n=t[2],e=t[3];return Number("0b"+i(t[0])+i(r)+i(n)+i(e))},a=void 0;try{a=Boolean(Buffer)}catch(t){a=!1}var l=function(t,r,n){switch(void 0===n&&(n=0),r){case"uint8":return a?t.readUInt8(n):t.getUint8(n);case"uint16":return a?t.readUInt16LE(n):t.getUint16(n,!0);case"uint32":return a?t.readUInt32LE(n):t.getUint32(n,!0);case"float":return a?t.readFloatLE(n):t.getFloat32(n,!0);default:throw new Error("No type specified")}},u=function(t){return(new TextDecoder).decode(t)},f={exportStl:function(r,e){void 0===e&&(e={});var i=e.description,l=void 0===i?"":i,u=e.binary,f=e.color,s=void 0===f?null:f,c=e.material,d=void 0===c?null:c;if(void 0===u||u){var v=Array.isArray(s)&&4===s.length?s:null,p=v&&Array.isArray(d)&&3===d.length?d:null;if(p){var g=d[0],y=d[1],m=d[2];p=(p=(p=p&&Array.isArray(g)&&3===g.length?d:null)&&Array.isArray(y)&&3===y.length?d:null)&&Array.isArray(m)&&3===m.length?d:null}return function(r,n,e,i){var l=r.length,u=function(t){var r=a?Buffer.alloc(t):new DataView(new ArrayBuffer(t));return a&&r.fill(0,0,80),{writeBuffer:function(t,n,e){switch(void 0===e&&(e=0),t){case"uint8":return a?r.writeUInt8(n,e):r.setUint8(e,n);case"uint16":return a?r.writeUInt16LE(n,e):r.setUint16(e,n,!0);case"uint32":return a?r.writeUInt32LE(n,e):r.setUint32(e,n,!0);case"float":return a?r.writeFloatLE(n,e):r.setFloat32(e,n,!0);case"string":return a?r.write(n,e):function(t,r,n){void 0===r&&(r=""),void 0===n&&(n=0);var e=0;r.split("").forEach((function(r){t.setUint8(n+e,r.charCodeAt(0)),++e}))}(r,n,e);default:throw new Error("No type specified")}},getBuffer:function(){return a?r:r.buffer}}}(84+12*l*4+2*l),f=u.writeBuffer,s=u.getBuffer;if(f("string",n),console.log("color=",e),e){f("string"," COLOR=",47);var c=e[0],d=e[1],v=e[2],p=e[3];if(console.log(c,d,v,p),f("uint8",c,54),f("uint8",d,55),f("uint8",v,56),f("uint8",p,57),i){f("string",",MATERIAL=",58);var g=i[1],y=i[2];f("uint32",o(i[0]),68),f("uint32",o(g),72),f("uint32",o(y),76)}}f("uint32",l,80);for(var m=84,h=function(t){f("float",t,m),m+=4},x=0;x<r.length;x++){var w=r[x],A=w.normal||t(w.verts);h(A[0]),h(A[1]),h(A[2]);for(var E=0;E<w.verts.length;E++){var O=w.verts[E];h(O[0]),h(O[1]),h(O[2])}f("uint16",w.color||0,m),m+=2}return s()}(r,l,v,p)}return function(r,e){void 0===e&&(e="");for(var i="solid "+e.split(" COLOR=")[0].trim()+"\n",o=0;o<r.length;o++){var a=r[o],l=a.verts,u=a.normal||t(l);i+=n(u,l)}return i+"endsolid"}(r,l)},importStl:function(t){return"string"==typeof t&&"solid "===t.slice(0,6)?(console.log("type: ascii string"),e(t)):"undefined"!=typeof TextEncoder&&"object"==typeof t&&"solid "===u(t.slice(0,6))?(console.log("type: ascii string in ArrayBuffer (browser only)"),e(u(t))):"undefined"==typeof TextEncoder&&"object"==typeof t&&"solid "===t.toString().slice(0,6)?(console.log("type: ascii string in Buffer (nodeJS only)"),e(t.toString())):(console.log("type: binary buffer"),function(t){for(var r=a?Buffer.from(t):new DataView(t),n=[],e=0;e<80;++e)n.push(l(r,"uint8",e));var i=String.fromCharCode.apply(String,n);console.log(i);var o=i.indexOf(" COLOR=");console.log("colorIndex=",o);var u=null;-1!==o&&(u=[l(r,"uint8",o+7),l(r,"uint8",o+8),l(r,"uint8",o+9),l(r,"uint8",o+10)]),console.log("color retrived=",u);var f=null;-1!==i.indexOf("MATERIAL=")&&(f=[l(r,"uint32",o+9),l(r,"uint32",o+13),l(r,"uint32",o+17)]);for(var s=[],c=l(r,"uint32",80),d=84,v=function(){return l(r,"float",(d+=4)-4)},p=0;p<c;++p){var g=[v(),v(),v()],y=[[v(),v(),v()],[v(),v(),v()],[v(),v(),v()]],m=l(r,"uint16",d);d+=2,s.push({normal:g,verts:y,color:m})}return{description:i,facets:s,color:u,material:f}}(t))}};export default f;
//# sourceMappingURL=stereol.modern.js.map
