var r=r=>{var[t,e,n]=r,[i,o,a]=t,[l,s,u]=e,[f,c,d]=n,[v,p,g]=[l-i,s-o,u-a],[y,m,h]=[f-i,c-o,d-a],[x,w,A]=[p*h-g*m,g*y-v*h,v*m-p*y],E=Math.sqrt(x*x+w*w+A*A);return 0===E?[0,0,0]:[x,w,A].map(r=>r/E)},t=(r,t,e)=>[r,t,e].map(r=>r.toExponential()),e=(r,e)=>"facet normal "+t(...r).join(" ")+"\n  outer loop\n    vertex "+t(...e[0]).join(" ")+"\n    vertex "+t(...e[1]).join(" ")+"\n    vertex "+t(...e[2]).join(" ")+"\n  endloop\nendfacet\n",n=r=>{for(var[t,...e]=r.split("\n").filter(r=>""!==r.trim()),n=[],i=0,o=!1;!o&&i<e.length&&-1===e[i].indexOf("endsolid");)(o=(o=(o=(o=(o=e.length<i+6)||-1===e[i].indexOf("normal "))||-1===e[i+2].indexOf("vertex "))||-1===e[i+3].indexOf("vertex "))||-1===e[i+4].indexOf("vertex "))||(n.push({normal:e[i].split("normal ")[1].trim().split(" ").map(r=>parseFloat(r)),verts:[e[i+2].split("vertex ")[1].trim().split(" ").map(r=>parseFloat(r)),e[i+3].split("vertex ")[1].trim().split(" ").map(r=>parseFloat(r)),e[i+4].split("vertex ")[1].trim().split(" ").map(r=>parseFloat(r))]}),i+=7);if(o)throw new Error("This file is not formatted correctly.");return{description:t.slice(6),facets:n}},i=r=>(function(r,t){return void 0===t&&(t=255),Math.max(0,Math.min(t,parseInt(r,10)))})(r).toString(2).padStart(8,"0"),o=r=>{var[t,e,n,o]=r;return Number("0b"+i(t)+i(e)+i(n)+i(o))},a=void 0;try{a=Boolean(Buffer)}catch(r){a=!1}var l=function(r,t,e){switch(void 0===e&&(e=0),t){case"uint8":return a?r.readUInt8(e):r.getUint8(e);case"uint16":return a?r.readUInt16LE(e):r.getUint16(e,!0);case"uint32":return a?r.readUInt32LE(e):r.getUint32(e,!0);case"float":return a?r.readFloatLE(e):r.getFloat32(e,!0);default:throw new Error("No type specified")}},s=r=>(new TextDecoder).decode(r),u={exportStl:function(t,n){void 0===n&&(n={});var{description:i="",binary:l=!0,color:s=null,material:u=null}=n;if(l){var f=Array.isArray(s)&&4===s.length?s:null,c=f&&Array.isArray(u)&&3===u.length?u:null;if(c){var[d,v,p]=u;c=(c=(c=c&&Array.isArray(d)&&3===d.length?u:null)&&Array.isArray(v)&&3===v.length?u:null)&&Array.isArray(p)&&3===p.length?u:null}return((t,e,n,i)=>{var l=t.length,s=84+12*l*4+2*l,{writeBuffer:u,getBuffer:f}=(r=>{var t=a?Buffer.alloc(r):new DataView(new ArrayBuffer(r));return a&&t.fill(0,0,80),{writeBuffer:function(r,e,n){switch(void 0===n&&(n=0),r){case"uint8":return a?t.writeUInt8(e,n):t.setUint8(n,e);case"uint16":return a?t.writeUInt16LE(e,n):t.setUint16(n,e,!0);case"uint32":return a?t.writeUInt32LE(e,n):t.setUint32(n,e,!0);case"float":return a?t.writeFloatLE(e,n):t.setFloat32(n,e,!0);case"string":return a?t.write(e,n):function(r,t,e){void 0===t&&(t=""),void 0===e&&(e=0);var n=0;t.split("").forEach(t=>{r.setUint8(e+n,t.charCodeAt(0)),++n})}(t,e,n);default:throw new Error("No type specified")}},getBuffer:()=>a?t:t.buffer}})(s);if(u("string",e),console.log("color=",n),n){u("string"," COLOR=",47);var[c,d,v,p]=n;if(console.log(c,d,v,p),u("uint8",c,54),u("uint8",d,55),u("uint8",v,56),u("uint8",p,57),i){u("string",",MATERIAL=",58);var[g,y,m]=i;u("uint32",o(g),68),u("uint32",o(y),72),u("uint32",o(m),76)}}u("uint32",l,80);for(var h=84,x=r=>{u("float",r,h),h+=4},w=0;w<t.length;w++){var A=t[w],E=A.normal||r(A.verts);x(E[0]),x(E[1]),x(E[2]);for(var O=0;O<A.verts.length;O++){var U=A.verts[O];x(U[0]),x(U[1]),x(U[2])}u("uint16",A.color||0,h),h+=2}return f()})(t,i,f,c)}return function(t,n){void 0===n&&(n="");for(var i="solid "+n.split(" COLOR=")[0].trim()+"\n",o=0;o<t.length;o++){var a=t[o],l=a.verts,s=a.normal||r(l);i+=e(s,l)}return i+"endsolid"}(t,i)},importStl:r=>"string"==typeof r&&"solid "===r.slice(0,6)?(console.log("type: ascii string"),n(r)):"undefined"!=typeof TextEncoder&&"object"==typeof r&&"solid "===s(r.slice(0,6))?(console.log("type: ascii string in ArrayBuffer (browser only)"),n(s(r))):"undefined"==typeof TextEncoder&&"object"==typeof r&&"solid "===r.toString().slice(0,6)?(console.log("type: ascii string in Buffer (nodeJS only)"),n(r.toString())):(console.log("type: binary buffer"),(r=>{for(var t=a?Buffer.from(r):new DataView(r),e=[],n=0;n<80;++n)e.push(l(t,"uint8",n));var i=String.fromCharCode(...e);console.log(i);var o=i.indexOf(" COLOR=");console.log("colorIndex=",o);var s=null;-1!==o&&(s=[l(t,"uint8",o+7),l(t,"uint8",o+8),l(t,"uint8",o+9),l(t,"uint8",o+10)]),console.log("color retrived=",s);var u=null;-1!==i.indexOf("MATERIAL=")&&(u=[l(t,"uint32",o+9),l(t,"uint32",o+13),l(t,"uint32",o+17)]);for(var f=[],c=l(t,"uint32",80),d=84,v=()=>l(t,"float",(d+=4)-4),p=0;p<c;++p){var g=[v(),v(),v()],y=[[v(),v(),v()],[v(),v(),v()],[v(),v(),v()]],m=l(t,"uint16",d);d+=2,f.push({normal:g,verts:y,color:m})}return{description:i,facets:f,color:s,material:u}})(r))};export default u;
//# sourceMappingURL=stereol.modern.js.map
