{"version":3,"file":"stereol.modern.js","sources":["../src/stl-utils.js","../src/ascii-stl.js","../src/colors.js","../src/binary-stl.js","../src/index.js"],"sourcesContent":["/**\n * Heavily inspired by https://github.com/tmpvar/stl\n * Allow to create .stl content as ASCII or binary in NodeJS and browser.\n */\nexport const computeNormal = ([a, b, c]) => {\n  const [x0, y0, z0] = a\n  const [x1, y1, z1] = b\n  const [x2, y2, z2] = c\n  const [p1x, p1y, p1z] = [x1 - x0, y1 - y0, z1 - z0]\n  const [p2x, p2y, p2z] = [x2 - x0, y2 - y0, z2 - z0]\n  const [p3x, p3y, p3z] = [\n    p1y * p2z - p1z * p2y,\n    p1z * p2x - p1x * p2z,\n    p1x * p2y - p1y * p2x\n  ]\n  const mag = Math.sqrt(p3x * p3x + p3y * p3y + p3z * p3z)\n  if (mag === 0) {\n    return [0, 0, 0]\n  }\n  return [p3x, p3y, p3z].map(p => p / mag)\n}","import { computeNormal } from './stl-utils'\n\nconst trim = (a) => {\n  let nullTerm = a.indexOf('\\u0000')\n  if (nullTerm > -1) {\n    a = a.substr(0, nullTerm)\n  }\n  return a.trim()\n}\n\nconst exp = (x, y, z) => ([x, y, z].map(x => x.toExponential()))\n\nconst asciiFacet = (n, v) => (\n`facet normal ${exp(...n).join(' ')}\n  outer loop\n    vertex ${exp(...v[0]).join(' ')}\n    vertex ${exp(...v[1]).join(' ')}\n    vertex ${exp(...v[2]).join(' ')}\n  endloop\nendfacet\n`)\n\nexport const toASCII = (facets, description = '') => {\n  let str = 'solid ' + description.split(' COLOR=')[0].trim() + '\\n'\n  for (let j = 0; j < facets.length; j++) {\n    const facet = facets[j]\n    const v = facet.verts\n    const n = facet.normal || computeNormal(v)\n    str += asciiFacet(n, v)\n  }\n  str += 'endsolid'\n  return str\n}\n\nexport const fromASCII = (data) => {\n  const [desc, ...lines] = data.split('\\n').filter(x => x.trim() !== '')\n  const facets = []\n  let lineIndex = 0\n  let broken = false\n  while (!broken && lineIndex < lines.length && lines[lineIndex].indexOf('endsolid') === -1) {\n    broken = lines.length < lineIndex + 6\n    broken = broken || lines[lineIndex].indexOf('normal ') === -1\n    broken = broken || lines[lineIndex + 2].indexOf('vertex ') === -1\n    broken = broken || lines[lineIndex + 3].indexOf('vertex ') === -1\n    broken = broken || lines[lineIndex + 4].indexOf('vertex ') === -1\n    if (!broken) {\n      facets.push({\n        normal: lines[lineIndex].split('normal ')[1].trim().split(' ').map(x => parseFloat(x)),\n        verts: [\n          lines[lineIndex + 2].split('vertex ')[1].trim().split(' ').map(x => parseFloat(x)),\n          lines[lineIndex + 3].split('vertex ')[1].trim().split(' ').map(x => parseFloat(x)),\n          lines[lineIndex + 4].split('vertex ')[1].trim().split(' ').map(x => parseFloat(x))\n        ]\n      })\n      lineIndex += 7\n    }\n  }\n  if (broken) {\n    throw new Error('This file is not formatted correctly.')\n  }\n  return {\n    description : desc.slice(6),\n    facets\n  }\n}","const limited = (value, max = 0xFF) => Math.max(0, Math.min(max, parseInt(value, 10)))\nconst facetColorPart = (part) => limited(part, 31).toString(2).padStart(5, '0')\nconst stlColorPart = (part) => limited(part).toString(2).padStart(8, '0')\n\n// convert a 24 bit binary color to 0..255 R,G,B\nconst binToRGB = (bin) => {\n  var r = bin >> 16\n  var g = bin >> 8 & 0xFF\n  var b = bin & 0xFF\n  return [r,g,b]\n}\n\nexport default {\n  /*\n  Computes a 16 bits BGR color with this format: \n  bits 0 to 4 are the intensity level for blue (0 to 31),\n  bits 5 to 9 are the intensity level for green (0 to 31),\n  bits 10 to 14 are the intensity level for red (0 to 31),\n  bit 15 is 1 if the color is valid, or 0 if the color is not valid (as with normal STL files).\n  */\n  getFacetColor: ([r, g, b]) => Number(`0b${ facetColorPart(b) }${ facetColorPart(g) }${ facetColorPart(r) }1`),\n\n  /* Computes a 32 bits RGBA color */\n  getStlColor: ([r, g, b, a]) => Number(`0b${ stlColorPart(r) }${ stlColorPart(g) }${ stlColorPart(b) }${ stlColorPart(a) }`),\n\n  binToRGB\n}","import Colors from './colors'\nimport { computeNormal } from './stl-utils'\n\nlet IS_NODEJS = undefined\ntry {\n  IS_NODEJS = Boolean(Buffer)\n} catch (e) {\n  IS_NODEJS = false\n}\n\nconst writeBufferString = (buffer, value = '', offset = 0) => {\n  let step = 0\n  value.split('').forEach(char => {\n    buffer.setUint8(offset + step, char.charCodeAt(0))\n    ++step\n  })\n}\n\nconst createBuffer = (size) => {\n  const buffer = IS_NODEJS ? Buffer.alloc(size) : new DataView(new ArrayBuffer(size))\n  if (IS_NODEJS) {\n    buffer.fill(0, 0, 80)\n  }\n  return {\n    writeBuffer: (type, value, offset = 0) => {\n      switch (type) {\n        case 'uint8': return IS_NODEJS ? buffer.writeUInt8(value, offset) : buffer.setUint8(offset, value)\n        case 'uint16': return IS_NODEJS ? buffer.writeUInt16LE(value, offset) : buffer.setUint16(offset, value, true)\n        case 'uint32': return IS_NODEJS ? buffer.writeUInt32LE(value, offset) : buffer.setUint32(offset, value, true)\n        case 'float': return IS_NODEJS ? buffer.writeFloatLE(value, offset) : buffer.setFloat32(offset, value, true)\n        case 'string': return IS_NODEJS ? buffer.write(value, offset) : writeBufferString(buffer, value, offset)\n        default: {\n          throw new Error('No type specified')\n        }\n      }\n    },\n    getBuffer: () => IS_NODEJS ? buffer : buffer.buffer\n  }\n}\n\nconst readBuffer = (buffer, type, offset = 0) => {\n  switch (type) {\n    case 'uint8': return IS_NODEJS ? buffer.readUInt8(offset) : buffer.getUint8(offset)\n    case 'uint16': return IS_NODEJS ? buffer.readUInt16LE(offset) : buffer.getUint16(offset, true)\n    case 'uint32': return IS_NODEJS ? buffer.readUInt32LE(offset) : buffer.getUint32(offset, true)\n    case 'float': return IS_NODEJS ? buffer.readFloatLE(offset) : buffer.getFloat32(offset, true)\n    default: {\n      throw new Error('No type specified')\n    }\n  }\n}\n\nexport const toBinary = (facets, description, color, material) => {\n  const count = facets.length\n  const size = 84 + count * 12 * 4 + count * 2\n  const { writeBuffer, getBuffer } = createBuffer(size)\n  writeBuffer('string', description)\n  console.log('color=', color)\n  if (color) {\n    writeBuffer('string', ' COLOR=', 47)\n    const [r, g, b, a] = color\n    console.log(r, g, b, a)\n    writeBuffer('uint8', r, 54)\n    writeBuffer('uint8', g, 55)\n    writeBuffer('uint8', b, 56)\n    writeBuffer('uint8', a, 57)\n    if (material) {\n      writeBuffer('string', ',MATERIAL=', 58)\n      const [ diffuse, specular, ambient ] = material\n      writeBuffer('uint32', Colors.getStlColor(diffuse), 68)\n      writeBuffer('uint32', Colors.getStlColor(specular), 72)\n      writeBuffer('uint32', Colors.getStlColor(ambient), 76)\n    }\n  }\n  writeBuffer('uint32', count, 80)\n\n  let offset = 84\n  const write = (value) => {\n    writeBuffer('float', value, offset)\n    offset += 4\n  }\n  for (let j = 0; j<facets.length; j++) {\n    const facet = facets[j]\n    const n = facet.normal || computeNormal(facet.verts)\n    write(n[0])\n    write(n[1])\n    write(n[2])\n    for (var i = 0; i<facet.verts.length; i++) {\n      const vert = facet.verts[i]\n      write(vert[0])\n      write(vert[1])\n      write(vert[2])\n    }\n    //const facetColor = facet.color ? Colors.getFacetColor(facet.color) : 0\n    writeBuffer('uint16', facet.color || 0, offset)\n    offset += 2\n  }\n  return getBuffer()\n}\n\nexport const fromBinary = (data) => {\n  const buffer = IS_NODEJS ? Buffer.from(data) : new DataView(data)\n\n  // retrieve description\n  let header = []\n  for (let i = 0; i < 80; ++i) {\n    header.push(readBuffer(buffer, 'uint8', i))\n  }\n  const description = String.fromCharCode(...header)\n  console.log(description)\n\n  // retrieve main color\n  const colorIndex = description.indexOf(' COLOR=')\n  console.log('colorIndex=', colorIndex)\n  let color = null\n  if (colorIndex !== -1) {\n    color = [\n      readBuffer(buffer, 'uint8', colorIndex + 7),\n      readBuffer(buffer, 'uint8', colorIndex + 8),\n      readBuffer(buffer, 'uint8', colorIndex + 9),\n      readBuffer(buffer, 'uint8', colorIndex + 10)\n    ]\n  }\n\n  console.log('color retrived=', color)\n\n  // retrieve material\n  const materialIndex = description.indexOf('MATERIAL=')\n  let material = null\n  if (materialIndex !== -1) {\n    material = [\n      readBuffer(buffer, 'uint32', colorIndex + 9),\n      readBuffer(buffer, 'uint32', colorIndex + 13),\n      readBuffer(buffer, 'uint32', colorIndex + 17)\n    ]\n  }\n\n  // retrieve facets\n  const facets = []\n  const countFacets = readBuffer(buffer, 'uint32', 80)\n  let headIndex = 84\n  const read = () => {\n    headIndex += 4\n    return readBuffer(buffer, 'float', headIndex - 4)\n  }\n  for (let i = 0; i < countFacets; ++i) {\n    const normal = [read(), read(), read()]\n    const verts = [\n      [read(), read(), read()],\n      [read(), read(), read()],\n      [read(), read(), read()]\n    ]\n    const facetColor = readBuffer(buffer, 'uint16', headIndex)\n    headIndex += 2\n    facets.push({\n      normal,\n      verts,\n      color: facetColor\n    })\n  }\n  return {\n    description,\n    facets,\n    color,\n    material\n  }\n}","import { toASCII, fromASCII } from './ascii-stl'\nimport { toBinary, fromBinary } from './binary-stl'\n\nconst exportStl = (facets, options = {}) => {\n  const {\n    description = '',\n    binary = true,\n    color = null,\n    material = null\n  } = options\n  if (binary) {\n    // colors exists only in unofficials specs and are exclusive to binary file format\n    // more details: https://en.wikipedia.org/wiki/STL_(file_format)#Color_in_binary_STL\n    const stlColor = Array.isArray(color) && color.length === 4 ? color : null\n    let stlMaterial = stlColor && Array.isArray(material) && material.length === 3 ? material : null\n    if (stlMaterial) {\n      const [a,b,c] = material\n      stlMaterial = stlMaterial && Array.isArray(a) && a.length === 3 ? material : null\n      stlMaterial = stlMaterial && Array.isArray(b) && b.length === 3 ? material : null\n      stlMaterial = stlMaterial && Array.isArray(c) && c.length === 3 ? material : null\n    }\n    return toBinary(facets, description, stlColor, stlMaterial)\n  } else {\n    return toASCII(facets, description)\n  }\n}\n\nconst arrayBufferToString = (ab) => {\n  const decoder = new TextDecoder()\n  return decoder.decode(ab)\n}\n\nconst importStl = (data) => {\n  if (typeof data === 'string' && data.slice(0, 6) === 'solid ') {\n    console.log('type: ascii string')\n    return fromASCII(data)\n  } else if (typeof(TextEncoder) !== 'undefined' && typeof data === 'object' && arrayBufferToString(data.slice(0, 6)) === 'solid ') {\n    console.log('type: ascii string in ArrayBuffer (browser only)')\n    return fromASCII(arrayBufferToString(data))\n  } else if (typeof(TextEncoder) === 'undefined' && typeof data === 'object' && data.toString().slice(0, 6) === 'solid ') {\n    console.log('type: ascii string in Buffer (nodeJS only)')\n    return fromASCII(data.toString())\n  } else {\n    console.log('type: binary buffer')\n    return fromBinary(data)\n  }\n}\n\nexport default {\n  exportStl,\n  importStl\n}\n"],"names":["computeNormal","a","b","c","x0","y0","z0","x1","y1","z1","x2","y2","z2","p1x","p1y","p1z","p2x","p2y","p2z","p3x","p3y","p3z","mag","Math","sqrt","map","p","exp","x","y","z","toExponential","asciiFacet","n","v","join","fromASCII","data","desc","lines","split","filter","trim","facets","lineIndex","broken","length","indexOf","push","normal","parseFloat","verts","Error","description","slice","stlColorPart","part","value","max","min","parseInt","limited","toString","padStart","r","g","Number","IS_NODEJS","undefined","Boolean","Buffer","e","readBuffer","buffer","type","offset","readUInt8","getUint8","readUInt16LE","getUint16","readUInt32LE","getUint32","readFloatLE","getFloat32","arrayBufferToString","ab","TextDecoder","decode","exportStl","options","binary","color","material","stlColor","Array","isArray","stlMaterial","count","size","writeBuffer","getBuffer","alloc","DataView","ArrayBuffer","fill","writeUInt8","setUint8","writeUInt16LE","setUint16","writeUInt32LE","setUint32","writeFloatLE","setFloat32","write","step","forEach","char","charCodeAt","writeBufferString","createBuffer","console","log","diffuse","specular","ambient","Colors","j","facet","i","vert","toBinary","str","toASCII","importStl","TextEncoder","from","header","String","fromCharCode","colorIndex","countFacets","headIndex","read","facetColor","fromBinary"],"mappings":"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"}